# Настройка Cloudflare API Token для SSL сертификатов

## Как получить Cloudflare API Token

1. **Войдите в панель Cloudflare:**
   - Перейдите на https://dash.cloudflare.com/
   - Войдите в свою учетную запись

2. **Создайте API Token:**
   - В правом верхнем углу нажмите на свой профиль
   - Выберите "My Profile"
   - Перейдите на вкладку "API Tokens"
   - Нажмите "Create Token"

3. **Настройте права токена:**
   - Используйте шаблон "Custom token"
   - **Permissions:**
     - Zone:Zone:Read
     - Zone:DNS:Edit
   - **Zone Resources:**
     - Include: Specific zone: `graywrk.ru` (или ваш домен)
   - **Client IP Address Filtering:** (необязательно)
     - Можете указать IP адрес вашего сервера для дополнительной безопасности

4. **Создайте и скопируйте токен:**
   - Нажмите "Continue to summary"
   - Нажмите "Create Token"
   - **ВАЖНО:** Скопируйте токен сразу - он больше не будет показан!

5. **Добавьте токен в .env:**
   ```bash
   CLOUDFLARE_API_TOKEN=ваш_скопированный_токен_здесь
   ```

## Проверка токена

Для проверки токена выполните:
```bash
curl -X GET "https://api.cloudflare.com/client/v4/user/tokens/verify" \
  -H "Authorization: Bearer ваш_токен_здесь"
```

Должен вернуться ответ со статусом `"success": true`.

## Важные замечания

- Токен предоставляет доступ к DNS записям вашего домена
- Храните токен в безопасности
- Не добавляйте реальный токен в git репозиторий
- Токен можно отозвать в любое время в панели Cloudflare

## Текущее состояние

В настоящее время приложение настроено для работы с Cloudflare в качестве прокси.
Если вы хотите использовать полный SSL с DNS challenge:

1. Получите Cloudflare API токен (инструкции выше)
2. Добавьте токен в .env файл
3. Настройте кастомный Caddy образ с DNS плагином
4. Обновите docker-compose.yml для использования build вместо image

## Альтернативное решение (рекомендуется для начала)

Используйте Cloudflare для SSL терминации:
1. В панели Cloudflare включите "Full" SSL mode
2. Приложение будет работать по HTTP внутри, но пользователи увидят HTTPS
3. Это проще настроить и более безопасно для продакшена